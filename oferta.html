<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oferta Especial | Educa Materiais</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .loading-spinner {
            width: 18px; height: 18px; border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff; border-radius: 50%;
            animation: spin 1s linear infinite; display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-md w-full bg-white rounded-[2.5rem] shadow-2xl shadow-slate-200 overflow-hidden border border-slate-100 fade-in">
        
        <div class="relative">
            <img src="https://placehold.co/600x450/6366f1/ffffff?text=Combo+AlfabetizaÃ§Ã£o" class="w-full h-64 object-cover">
            <div class="absolute top-4 left-4">
                <span class="bg-white/90 backdrop-blur-sm text-orange-600 px-3 py-1 rounded-full text-xs font-black uppercase shadow-sm">ðŸ”¥ Oferta Limitada</span>
            </div>
        </div>

        <div class="p-8">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-black text-slate-800 leading-tight">Combo AlfabetizaÃ§Ã£o Criativa</h1>
                <p class="text-slate-500 text-sm mt-2 px-4">50 pÃ¡ginas de atividades prontas para imprimir em PDF.</p>
            </div>

            <div class="flex items-center justify-center gap-2 mb-8">
                <span class="text-slate-400 line-through text-sm">R$ 0,3</span>
                <span class="text-4xl font-black text-green-600">R$ 0,3</span>
            </div>

            <div id="etapa-email" class="space-y-4">
                <div class="relative">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-1 block">Seu melhor e-mail</label>
                    <input type="email" id="email-cliente" 
                        class="w-full px-5 py-4 rounded-2xl bg-slate-50 border-2 border-transparent focus:border-orange-500 focus:bg-white outline-none transition-all font-medium" 
                        placeholder="seu-email@exemplo.com">
                </div>

                <button onclick="gerarPagamentoPix()" id="btn-comprar"
                    class="w-full bg-orange-500 hover:bg-orange-600 text-white py-5 rounded-2xl font-black text-lg transition-all active:scale-95 shadow-xl shadow-orange-200 flex items-center justify-center gap-3">
                    COMPRAR AGORA
                </button>
                
                <div class="pt-2 text-center">
                    <a href="https://educamateriais.shop/loja" class="text-slate-400 hover:text-slate-600 text-sm font-semibold transition-colors flex items-center justify-center gap-2">
                        <span>Ou ver outros materiais na loja</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                    </a>
                </div>
            </div>

            <div id="area-pagamento" class="hidden space-y-6 pt-4 border-t border-slate-100 fade-in">
                <div class="text-center">
                    <p class="text-sm font-bold text-slate-700 mb-4">Escaneie o QR Code para pagar:</p>
                    <div id="qrcode-placeholder" class="inline-block p-4 bg-white rounded-3xl border-2 border-slate-100 shadow-inner"></div>
                </div>

                <div class="space-y-3">
                    <button onclick="copiarPix()" class="w-full py-3 text-sm font-bold text-indigo-600 bg-indigo-50 rounded-xl">ðŸ“‹ Copiar CÃ³digo PIX</button>
                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                        <p class="text-[10px] text-blue-800 leading-relaxed text-center font-bold">
                            NÃ£o feche esta pÃ¡gina! ApÃ³s o pagamento, o download serÃ¡ liberado automaticamente aqui.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pixCopiaECola = "";
        let monitoramento = null;
        const LINK_PDF = "https://educamateriais.shop/downloads/material-alfabetizacao.pdf";

        async function gerarPagamentoPix() {
            const email = document.getElementById('email-cliente').value.trim();
            const btn = document.getElementById('btn-comprar');

            if (!email || !email.includes('@')) {
                alert("Por favor, insira um e-mail vÃ¡lido.");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<span class="loading-spinner"></span> Aguarde...`;

            try {
                const response = await fetch('https://educamateriais.shop/criar-pagamento-pix', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, total: 19.90, itens: "Combo AlfabetizaÃ§Ã£o" })
                });

                const dados = await response.json();

                if (dados.qr_code_base64) {
                    document.getElementById('etapa-email').classList.add('hidden');
                    document.getElementById('area-pagamento').classList.remove('hidden');
                    document.getElementById('qrcode-placeholder').innerHTML = `<img src="data:image/png;base64,${dados.qr_code_base64}" class="w-48 h-48 mx-auto">`;
                    pixCopiaECola = dados.qr_code;
                    iniciarMonitoramento(dados.id);
                }
            } catch (err) {
                alert("Erro ao gerar PIX. Tente novamente.");
                btn.disabled = false; btn.innerHTML = "COMPRAR AGORA";
            }
        }

        function iniciarMonitoramento(id) {
            monitoramento = setInterval(async () => {
                try {
                    const res = await fetch(`https://educamateriais.shop/verificar-pagamento/${id}`);
                    const data = await res.json();
                    if (data.status === 'approved') {
                        clearInterval(monitoramento);
                        sucessoTotal();
                    }
                } catch (e) { console.error("Erro check"); }
            }, 5000);
        }

        function sucessoTotal() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            document.getElementById('area-pagamento').innerHTML = `
                <div class="py-8 text-center fade-in">
                    <div class="text-5xl mb-4">âœ…</div>
                    <h2 class="text-2xl font-black text-slate-800">Pagamento Aprovado!</h2>
                    <p class="text-slate-500 mb-6">Seu material estÃ¡ pronto para download.</p>
                    <a href="${LINK_PDF}" download class="inline-block w-full bg-green-600 text-white py-5 rounded-2xl font-black text-lg shadow-xl shadow-green-100 transition-transform active:scale-95">ðŸš€ BAIXAR AGORA</a>
                </div>`;
        }

        function copiarPix() {
            navigator.clipboard.writeText(pixCopiaECola);
            alert("CÃ³digo copiado!");
        }
    </script>
</body>
</html>